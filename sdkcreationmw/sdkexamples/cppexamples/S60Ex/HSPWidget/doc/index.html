<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>[HsWidget]</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>

<table border="0" width="100%" height="8" bgcolor="#eeeeee">
<tr> <td width="100%" height="1"><b><font size="2" color="#000000" face="Arial, Helvetica, sans-serif"><strong><a name=Top></a>
Nokia N97 SDK </strong></font></b><br><i>Example Applications Guide</i></td></tr> </table>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li id="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>[HsWidget]</h1>
<p>
<a class="el" href="index.html#Intro_sec">1. An example application HsWidget.</a> <br>
<a class="el" href="index.html#Sub11">1.1 Homescreen Publishing Api - C++ SDK API.</a> <br>
<a class="el" href="index.html#Prerequisites_sec">2. Prerequisites</a> <br>
<a class="el" href="index.html#Sub21">2.1 Include Library.</a> <br>
<a class="el" href="index.html#Sub22">2.2 Header files</a> <br>
<a class="el" href="index.html#Sub23">2.3 Capabilities</a> <br>
<a class="el" href="index.html#UseCase_sec">3. Use cases</a> <br>
<a class="el" href="index.html#sub31">3.1 Creation of the Homescreen Publisher and observer.</a> <br>
<a class="el" href="index.html#sub32">3.2 Creation of widget.</a> <br>
<a class="el" href="index.html#sub33">3.3 Add items to widget.</a> <br>
<a class="el" href="index.html#sub34">3.4 Publish the widget.</a> <br>
<a class="el" href="index.html#sub35">3.5 Update the data in the widget.</a> <br>
<a class="el" href="index.html#sub36">3.6 Observe widget's and items' events.</a> <br>
<a class="el" href="index.html#Arch_sec">4. Architecture</a> <br>
<a class="el" href="index.html#sub41">4.1 Class diagram.</a><p>
<hr>
<h2><a class="anchor" name="Intro_sec">
1. An example application HsWidget.</a></h2>
Symbian based application that publish its content to Home Screen (HS) Application with usage of Homescreen Publishing Api.<h3><a class="anchor" name="Sub11">
1.1 Homescreen Publishing Api - C++ SDK API.</a></h3>
Homescreen Publishing API (HsPApi) is C++ based framework that allows, C++ or Symbian based applications, to publish it's content in HS. All interfaces method contains standard C++ data types.<p>
<hr>
<h2><a class="anchor" name="Prerequisites_sec">
2. Prerequisites</a></h2>
<h3><a class="anchor" name="Sub21">
2.1 Include Library.</a></h3>
To use hswidgetpublisher.dll, client needs to library linking and .mmp file should contains lines below:<p>
<div class="fragment"><pre class="fragment"> LIBRARY    hswidgetpublisher.lib <span class="comment">//homescreen publishing api</span>
 LIBRARY    libstdcpp.lib         <span class="comment">//std library</span>
 LIBRARY    libc.lib              <span class="comment">//std library</span>
 LIBRARY    charconv.lib          <span class="comment">//string conversion</span>
</pre></div><h3><a class="anchor" name="Sub22">
2.2 Header files</a></h3>
To make available standard C++ headers by include paths should contain macros: <div class="fragment"><pre class="fragment"> OS_LAYER_LIBC_SYSTEMINCLUDE
 OS_LAYER_STDCPP_SYSTEMINCLUDE
</pre></div><p>
HsPApi necessary headers files: <div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;hswidgetpublisher.h&gt;</span>
<span class="preprocessor"> #include &lt;hswidget.h&gt;</span>
<span class="preprocessor"> #include &lt;hsexception.h&gt;</span>
<span class="preprocessor"> #include &lt;hsdataobserver.h&gt;</span>
</pre></div><p>
HsPApi uses C++ standard string data in format UTF-8. The .rls file needs entry like below:<p>
<div class="fragment"><pre class="fragment"> <span class="comment">// .rls file</span>
 <span class="comment">//...</span>
 CHARACTER_SET UTF8
 <span class="comment">//...</span>
</pre></div><p>
To ensure use of C++ standard string client needs to include: <div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;string&gt;</span>
<span class="preprocessor"> #include &lt;utf.h&gt;</span>
</pre></div><p>
Example code that converts UNICODE to UTF-8 std::string data:<p>
<div class="fragment"><pre class="fragment">  string toString(<span class="keyword">const</span> TDesC&amp; aText)
     {
     HBufC8* text = HBufC8::NewL( aText.Length() + 4 <span class="comment">/*for ending zero*/</span> );
     TPtr8 dest( text-&gt;Des() );
     CnvUtfConverter::ConvertFromUnicodeToUtf8( dest, aText );    
     string ret((<span class="keyword">const</span> <span class="keywordtype">char</span>*)dest.PtrZ());
     <span class="keyword">delete</span> text;
     <span class="keywordflow">return</span> ret;
     }
</pre></div><h3><a class="anchor" name="Sub23">
2.3 Capabilities</a></h3>
No special capabilities are required.<p>
<hr>
<h2><a class="anchor" name="UseCase_sec">
3. Use cases</a></h2>
<h3><a class="anchor" name="sub31">
3.1 Creation of the Homescreen Publisher and observer.</a></h3>
<h4><a class="anchor" name="subsub311">
3.1.1 Data observer.</a></h4>
To create HsWidgetPublisher user needs to implement interface’s IHsDataObserver. <div class="fragment"><pre class="fragment"> <span class="keywordtype">void</span> <a class="code" href="class_c_hs_widget_example.html#89071e06b36f262824ed753246e4e959">CHsWidgetExample::handleEvent</a>( std::string aWidgetName, 
   Hs::IHsDataObserver::EEvent aEvent)    
   {
   }
 <span class="keywordtype">void</span> <a class="code" href="class_c_hs_widget_example.html#4a17bde62575a2c54346470cfae04db2">CHsWidgetExample::handleItemEvent</a>( std::string aWidgetName,
   std::string aWidgetItemName,
   Hs::IHsDataObserver::EItemEvent aEvent)
   {
   }
</pre></div><h4><a class="anchor" name="subsub312">
3.1.2 Homescreen Publisher.</a></h4>
User needs to care about <a class="el" href="index.html#subsub313">3.1.3 Exception handling.</a> and <a class="el" href="index.html#subsub314">3.1.4 Allocation memory handling.</a>.<p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">void</span> <a class="code" href="class_c_hs_widget_example.html#9ce34ba0b947863222da3c63d0481044">CHsWidgetExample::ConstructL</a>()
    {
    <span class="keywordflow">try</span>
        {
        <a class="code" href="class_c_hs_widget_example.html#6778eb03dea5f1e5ae3e72723da2bb69">iHsWidgetPublisher</a> = <span class="keyword">new</span> Hs::HsWidgetPublisher( <span class="keyword">this</span> );
        }
    ...
    }
</pre></div><h4><a class="anchor" name="subsub313">
3.1.3 Exception handling.</a></h4>
HsPApi is C++ component and it doesn't use Symbian Leaves system. Instead, it uses C++ exception (HsException that is std::exception deriver) mechanism. HsException object contains information, compatible with Symbian errors, about exception reason. Moreover, HsPApi uses STD libraries so other exception, might also be thrown as error handling result.<p>
<div class="fragment"><pre class="fragment"> ... 
 <span class="keywordflow">try</span>
     {
     <span class="comment">// HSP method call   </span>
     }
 <span class="keywordflow">catch</span>( Hs::HsException&amp; e)
     {
     <span class="comment">//catch error from HsPApi</span>
     User::Leave( e.getReason() );
     }
 <span class="keywordflow">catch</span>( ... )
     {
     <span class="comment">//catch error from other libraries</span>
     User::Leave( KErrGeneral );
     }
 ...
</pre></div><h4><a class="anchor" name="subsub314">
3.1.4 Allocation memory handling.</a></h4>
Besides exception handling, user should to also take care about memory allocation handling because Symbian new operator return empty pointer in case of memory allocation problem. <div class="fragment"><pre class="fragment"> ...
 <span class="keywordflow">if</span>( iHsWidgetPublisher )
     {
     <span class="comment">// memory allocate properly, use iHsWidgetPublisher          </span>
     }
 <span class="keywordflow">else</span>
     {
     <span class="comment">// memory not allocated</span>
     )
 ... 
</pre></div><h3><a class="anchor" name="sub32">
3.2 Creation of widget.</a></h3>
<div align="center">
<img src="hsp_widget_register_widget.bmp" alt="hsp_widget_register_widget.bmp">
</div>
<p>
<div class="fragment"><pre class="fragment"> ...    
 iHsWidgetPublisher-&gt;createHsWidget( <span class="stringliteral">"onerow"</span>, <span class="stringliteral">"HSWidget"</span>, <span class="stringliteral">"0xA0007E04"</span> );
 ...
</pre></div><p>
<div align="center">
<img src="hsp_widget_registry.bmp" alt="hsp_widget_registry.bmp">
</div>
<p>
Once widget is created, it is available in list shown to the HS user. Widget can be added as content to HS and it will display current values. Because items were not added to widget, content doesn't contain valuable information. <div align="center">
<img src="hsp_widget_empty_value.bmp" alt="hsp_widget_empty_value.bmp">
</div>
<p>
<b></b><h3><a class="anchor" name="sub33">
3.3 Add items to widget.</a></h3>
While adding new items to widget, user needs to take care about widget pre-defined structure. Example widget is "onerow" type and contains two items: image and text. Sequence of adding does not matter.<p>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> <span class="keywordtype">char</span>* image = <span class="stringliteral">"image1"</span>;
 <span class="keyword">const</span> <span class="keywordtype">char</span>* text = <span class="stringliteral">"text1"</span>;

 ...
 iHsWidgetPublisher-&gt;getHsWidget( <span class="stringliteral">"onerow"</span>, <span class="stringliteral">"HSWidget"</span>, <span class="stringliteral">"0xA0007E04"</span> ).
     setItem( image, <span class="stringliteral">"mif(c:\\resource\\apps\\HSPWidget.mif 16388 16389)"</span> );
 iHsWidgetPublisher-&gt;getHsWidget( <span class="stringliteral">"onerow"</span>, <span class="stringliteral">"HSWidget"</span>, <span class="stringliteral">"0xA0007E04"</span> ).
     setItem( text, <span class="stringliteral">"First text: good morning"</span> );
 ...
</pre></div> <div align="center">
<img src="hsp_widget_change_values.bmp" alt="hsp_widget_change_values.bmp">
</div>
<h3><a class="anchor" name="sub34">
3.4 Publish the widget.</a></h3>
Publishing the widget may occur in event handling process and keeps HS data up to date. Each widget's item is being published in publish process. <div class="fragment"><pre class="fragment"> ...
 iHsWidgetPublisher-&gt;publishHsWidget( 
    iHsWidgetPublisher-&gt;getHsWidget( <span class="stringliteral">"onerow"</span>, <span class="stringliteral">"HSWidget"</span>, <span class="stringliteral">"0xA0007E04"</span> ) );
 ...
</pre></div><p>
<div align="center">
<img src="hsp_widget_event_resume.bmp" alt="hsp_widget_event_resume.bmp">
</div>
<p>
Items added to widget <a class="el" href="index.html#sub33">3.3 Add items to widget.</a> are displayed in HS. Widget contains image and localized string. <div align="center">
<img src="hsp_widget_first_value.bmp" alt="hsp_widget_first_value.bmp">
</div>
<h3><a class="anchor" name="sub35">
3.5 Update the data in the widget.</a></h3>
Once item were added to widget <a class="el" href="index.html#sub33">3.3 Add items to widget.</a> they might be updated with use of the same methods.<p>
<div class="fragment"><pre class="fragment"> ...
 iHsWidgetPublisher-&gt;getHsWidget( <span class="stringliteral">"onerow"</span>, <span class="stringliteral">"HSWidget"</span>, <span class="stringliteral">"0xA0007E04"</span> ).
     setItem( image, <span class="stringliteral">"c:\\data\\Images\\Pictures\\Sunny.JPG );</span>
<span class="stringliteral"> iHsWidgetPublisher-&gt;getHsWidget( "</span>onerow<span class="stringliteral">", "</span>HSWidget<span class="stringliteral">", "</span>0xA0007E04<span class="stringliteral">" ).</span>
<span class="stringliteral">     setItem( text, "</span>Second text: hyvää päivää<span class="stringliteral">" );</span>
<span class="stringliteral"> ...</span>
</pre></div><p>
<div align="center">
<img src="hsp_widget_change_values.bmp" alt="hsp_widget_change_values.bmp">
</div>
<p>
To update widget's data in HS, entire widget should be published and it happens during event handling <a class="el" href="index.html#sub34">3.4 Publish the widget.</a>. The result with visible widget below.<p>
<div align="center">
<img src="hsp_widget_second_value.bmp" alt="hsp_widget_second_value.bmp">
</div>
<h3><a class="anchor" name="sub36">
3.6 Observe widget's and items' events.</a></h3>
To observe events user needs to implement IHsDataObserver <a class="el" href="index.html#subsub311">3.1.1 Data observer.</a>.<h4><a class="anchor" name="subsub361">
3.6.1 IHsDataObserver::handleEvent(...).</a></h4>
Example of widget events handling <a class="el" href="index.html#sub34">3.4 Publish the widget.</a>. Events that are available for widget: <div class="fragment"><pre class="fragment"> <span class="keyword">enum</span> EEvent
     {
      EUnknown    = 0,
      EActivate   = 1,
      EDeactivate = 2,
      ESuspend    = 3,
      EResume     = 4     
      };
</pre></div> Each represent widget status from HS point of view.<h4><a class="anchor" name="subsub362">
3.6.2 IHSPDataObserver::handleItemEvent(...).</a></h4>
Events that are available for widget's item: <div class="fragment"><pre class="fragment"> <span class="keyword">enum</span> EItemEvent
     {
     EUnknownItemAction = 0,
     ESelection         = 1
     };
</pre></div><p>
Select is evoked per each widget's item as result of user's pointer on content area in HS.<p>
<div align="center">
<img src="hsp_widget_event_select.bmp" alt="hsp_widget_event_select.bmp">
</div>
<h3><a class="anchor" name="sub37">
3.7 Remove of the widget.</a></h3>
Remove of widget deletes all it's data from Homescreens Publishing Api. Content is also removed from HS conetnt list.<p>
<div class="fragment"><pre class="fragment"> ...    
 iHsWidgetPublisher-&gt;removeHsWidget( <span class="stringliteral">"onerow"</span>, <span class="stringliteral">"HsWidget"</span>, <span class="stringliteral">"0xA0007E04"</span> );
 ...
</pre></div><p>
<div align="center">
<img src="hsp_widget_remove.bmp" alt="hsp_widget_remove.bmp">
</div>
<p>
<hr>
<h2><a class="anchor" name="Arch_sec">
4. Architecture</a></h2>
HsWidget is a simple UI application that contains extra <a class="el" href="class_c_hs_widget_example.html">CHsWidgetExample</a> class. It implement abstract class IHsDataObserver and contains HsPApi interface. <a class="el" href="class_c_hs_widget_example.html">CHsWidgetExample</a> class is representation of simple widget, but it contains complex widget functionality described in section <a class="el" href="index.html#UseCase_sec">3. Use cases</a>.<h3><a class="anchor" name="sub41">
4.1 Class diagram.</a></h3>
<div align="center">
<img src="hsp_widget_class_diagram.bmp" alt="hsp_widget_class_diagram.bmp">
</div>
 <hr>

<table x-use-null-cells
		style="x-cell-content-align: top;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0
		width=100%>
  <col style="width: 50%;">
  <col style="width: 50%;">

  <tr style="x-cell-content-align: top;"
	valign=top>
  <td style="width: 50%;
			padding-right: 10px;
			padding-left: 10px;
			border-right-style: None;
			border-left-style: None;
			border-top-style: None;
			border-bottom-style: None;"
	width=50%>
  <p style="font-family: Arial;"><small style="font-size: smaller;">© Nokia 2009</small></td>
  <td style="width: 50%;
			padding-right: 10px;
			padding-left: 10px;
			border-top-style: None;
			border-bottom-style: None;
			border-right-style: None;"
	width=50%>
  <p style="text-align: right; margin-right: -4px;"
	align=right><span style="font-weight: bold;"><a href="#Top"
													title="Back to top"><img
 src="top.gif"
	x-maintain-ratio=TRUE
	alt="Back to top"
	style="border: none;
			width: 18px;
			height: 15px;
			float: none;
			border-style: none;
			border-style: none;"
	width=18
	height=15
	border=0></a></span></td></tr>
 </table>
</body>
</html>

